# Heatwave-ABM: Agent-Based Heatwave Simulation with LLM Hooks


# Process Step

pip install --upgrade google-genai


export  GEMINI_API_KEY=xxx
ref to:  https://chatgpt.com/c/69223684-0188-8328-8fd0-f186d105ad86

#  --no-llm   --silent     # turn on if needed  
python main.py   --agents-path    data/agents.csv   --weather-path data/weather.csv    --no-llm       

python visualize_results.py

# Introduction

This project simulates how **individual people (agents)** experience and respond to a **heatwave**, and how:

- Their **decisions** (drink water, go to hospital, turn on AC, reduce outdoor exposure)  
- Their **social context** (family and workplace / company)  
- Their **environment** (temperature, humidity, AC availability)  

combine to affect **physical health** and **mental health** over time.

The code is written so that you can:

1. Run everything with **pure Python rules** (no LLM required).  
2. Plug in a real **LLM API** later to:
   - Broadcast weather warnings.
   - Coordinate decisions inside families and companies.
   - Make decisions for individual agents.

It also logs **every decision by every agent on every day**, plus before/after states, so you can later **learn decision policies** from data (e.g., train your own models or analyze behavior).

---

## 1. Features Overview

- **Agent-based simulation**
  - Each agent has:
    - Demographics: `age`, `sex`, `job`
    - Baseline state: `baseline_health`, `baseline_mental`
    - Behavior traits: `outdoor_hours`, `risk_sensitivity`
  - State updates daily:
    - `health` ∈ [0, 1]
    - `mental` ∈ [0, 1]
    - `hydration` ∈ [0, 1]

- **Daily decisions per agent**
  Each day, every agent chooses:
  1. `drink_water` (bool)
  2. `go_hospital` (bool)
  3. `use_ac` (bool)
  4. `target_outdoor_hours` (float, 0–24)

- **Environment**
  - Daily **temperature** (°C) and **humidity** (0–1 or 0–100 in CSV).
  - Random **AC availability** each day (configurable probability).

- **Social structure**
  - **Families**: agents with the same `family_id`.
  - **Companies**: agents with the same `company_id`.
  - Each group can have a **shared decision** generated by an LLM (or rule-based fallback).

- **LLM hooks**
  - Weather broadcaster: “Today is high risk, stay inside.”
  - Family group chat: family members coordinate decisions.
  - Company safety meeting: workplace sets rules.
  - Per-agent assistant: individual-level recommendations.
  - All LLM pieces have **prompt builders** and **parsers**, but the actual call is a **stub** (`call_llm_api`) so the code runs without an API key.

- **Detailed logging**
  - For every `(day, agent)`:
    - Environment inputs
    - Agent state before decisions
    - Decisions taken
    - Agent state after decisions
  - Stored in `SimulationResult.agent_daily_log` as a list of dicts.
  - Perfect for downstream **learning/analysis** (e.g., learn policies, evaluate interventions).

---

## 2. Project Structure

```text
heatwave_abm/
├─ README.md              # This file
├─ requirements.txt       # (Empty / placeholder, uses stdlib only)
├─ main.py                # Entry point to run a simulation
├─ config.py              # Global parameters for risk & health dynamics
├─ agents.py              # Agent definition & decision logic
├─ environment.py         # EnvironmentState + weather loaders/generator
├─ groups.py              # Family & Company group coordination
├─ llm_interfaces.py      # LLM prompt builders, parsers, stubs
├─ data_loader.py         # CSV loaders for agents & groups
├─ simulation.py          # Simulation loop, logging, overall orchestration
└─ data/
   ├─ agents.csv          # Initial conditions for each agent
   └─ weather.csv         # Daily weather: temperature + humidity
